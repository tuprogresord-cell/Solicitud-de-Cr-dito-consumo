<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>Solicitud Préstamo de Consumo – TU PROGRESO RD</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <style>
    :root {
      --primary: #0d4a83;
      --success: #10b981;
      --light: #f8fafc;
      --border: #cbd5e1;
      --shadow: 0 4px 6px rgba(0,0,0,0.05);
    }

    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: 'Segoe UI', system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
      background: linear-gradient(135deg, #f0f4f8, #e2e8f0);
      color: #334155;
      padding: 12px;
      line-height: 1.4;
    }

    .container {
      max-width: 850px;
      margin: 0 auto;
    }

    .form-title {
      text-align: center;
      font-size: 20px;
      font-weight: 700;
      color: var(--primary);
      margin: 16px 0 20px;
    }

    .card {
      background: white;
      border-radius: 8px;
      box-shadow: var(--shadow);
      overflow: hidden;
      margin-bottom: 16px;
    }

    .card-header {
      background: var(--primary);
      color: white;
      padding: 10px 14px;
      font-weight: 600;
      font-size: 14px;
    }

    .card-body {
      padding: 14px;
    }

    .row { display: flex; flex-wrap: wrap; gap: 10px; margin-bottom: 12px; }
    .col-2 { flex: 1 1 calc(50% - 8px); }
    .col-3 { flex: 1 1 calc(33.333% - 8px); }
    .col-1 { flex: 1 1 100%; }

    label {
      display: block;
      font-weight: 600;
      margin-bottom: 4px;
      font-size: 13px;
      color: #475569;
    }

    input, select, textarea {
      width: 100%;
      padding: 8px 10px;
      border: 1px solid var(--border);
      border-radius: 5px;
      font-size: 14px;
    }

    .signature-check {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 10px;
      background: #f0fdf4;
      border-radius: 8px;
      margin-top: 10px;
      cursor: pointer;
    }
    .check-box {
      width: 20px;
      height: 20px;
      border: 2px solid var(--border);
      border-radius: 4px;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .check-box.checked {
      background: var(--success);
      border-color: var(--success);
    }
    .check-box.checked::after {
      content: "✔";
      color: white;
      font-weight: bold;
      font-size: 13px;
    }

    .upload-section {
      margin-top: 14px;
    }
    .upload-section h3 {
      margin: 14px 0 8px;
      font-size: 14px;
      font-weight: 600;
      color: #475569;
    }
    .upload-area {
      border: 2px dashed #cbd5e1;
      border-radius: 8px;
      padding: 12px;
      text-align: center;
      background: #f8fafc;
      cursor: pointer;
    }
    .upload-icon {
      font-size: 28px;
      color: #94a3b8;
      margin-bottom: 5px;
    }
    .file-preview {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
      margin-top: 8px;
    }
    .preview-item {
      width: 90px;
      border-radius: 5px;
      overflow: hidden;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    }
    .preview-item img {
      width: 100%;
      display: block;
    }

    .btn-group {
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
      margin-top: 18px;
      justify-content: center;
    }
    .btn {
      padding: 10px 20px;
      border: none;
      border-radius: 6px;
      font-weight: 600;
      cursor: pointer;
      font-size: 15px;
      flex: 1;
      max-width: 220px;
    }
    .btn-outline {
      background: transparent;
      border: 1px solid var(--primary);
      color: var(--primary);
    }

    .required::after {
      content: " *";
      color: #e11d48;
    }

    @media (max-width: 600px) {
      .col-2, .col-3 { flex: 1 1 100%; }
      .form-title { font-size: 18px; }
      .btn { width: 100%; }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1 class="form-title">SOLICITUD PRÉSTAMO DE CONSUMO</h1>

    <!-- Fecha y Deudor -->
    <div class="card">
      <div class="card-body">
        <div class="row">
          <div class="col-2">
            <label class="required">Fecha</label>
            <input type="date" id="fecha" />
          </div>
          <div class="col-2">
            <label class="required">Deudor</label>
            <input type="text" id="deudor" placeholder="Nombre completo" />
          </div>
        </div>
      </div>
    </div>

    <!-- DATOS DEL PRÉSTAMO -->
    <div class="card">
      <div class="card-header">DATOS DEL PRÉSTAMO</div>
      <div class="card-body">
        <div class="row">
          <div class="col-2">
            <label class="required">Monto Solicitado</label>
            <input type="text" id="montoSolicitado" inputmode="decimal" pattern="[0-9.,]*" />
          </div>
          <div class="col-2">
            <label class="required">Plazo</label>
            <input type="text" id="plazoNumero" inputmode="numeric" pattern="[0-9]*" placeholder="Ej: 12" />
          </div>
          <div class="col-2">
            <label class="required">Frecuencia</label>
            <select id="plazoFrecuencia">
              <option value="">Seleccione...</option>
              <option value="Mensual">Mensual</option>
              <option value="Quincenal">Quincenal</option>
              <option value="Semanal">Semanal</option>
            </select>
          </div>
          <div class="col-2">
            <label>Garantía</label>
            <input type="text" id="garantia" />
          </div>
          <div class="col-2">
            <label class="required">Destino del Préstamo</label>
            <input type="text" id="destino" />
          </div>
        </div>
      </div>
    </div>

    <!-- INFORMACIÓN PERSONAL -->
    <div class="card">
      <div class="card-header">INFORMACIÓN PERSONAL DEL SOLICITANTE</div>
      <div class="card-body">
        <div class="row">
          <div class="col-3">
            <label class="required">Nombres</label>
            <input type="text" id="nombres" />
          </div>
          <div class="col-3">
            <label class="required">Apellidos</label>
            <input type="text" id="apellidos" />
          </div>
          <div class="col-2">
            <label>Sexo</label>
            <select id="sexo">
              <option value="">Seleccione...</option>
              <option value="Masculino">Masculino</option>
              <option value="Femenino">Femenino</option>
              <option value="Otro">Otro</option>
            </select>
          </div>
          <div class="col-2">
            <label>Estado Civil</label>
            <select id="estadoCivil">
              <option value="">Seleccione...</option>
              <option value="Soltero/a">Soltero/a</option>
              <option value="Casado/a">Casado/a</option>
              <option value="Divorciado/a">Divorciado/a</option>
              <option value="Viudo/a">Viudo/a</option>
              <option value="Unión Libre">Unión Libre</option>
            </select>
          </div>
        </div>

        <div class="row">
          <div class="col-2">
            <label class="required">Fecha de Nacimiento</label>
            <input type="date" id="fechaNac" />
          </div>
          <div class="col-2">
            <label class="required">Tipo de Documento</label>
            <select id="tipoDocumento">
              <option value="Cédula">Cédula</option>
              <option value="Pasaporte">Pasaporte</option>
            </select>
          </div>
          <div class="col-2">
            <label class="required">Número de Documento</label>
            <input type="text" id="cedula" inputmode="text" />
          </div>
          <div class="col-2">
            <label>Profesión o Actividad</label>
            <input type="text" id="profesion" />
          </div>
          <div class="col-2">
            <label>Nacionalidad</label>
            <input type="text" id="nacionalidad" />
          </div>
          <div class="col-2">
            <label>Teléfono</label>
            <input type="tel" id="telefono" inputmode="tel" maxlength="12" placeholder="000-000-0000" />
          </div>
          <div class="col-2">
            <label>Celular</label>
            <input type="tel" id="celular" inputmode="tel" maxlength="12" placeholder="000-000-0000" />
          </div>
        </div>

        <div class="row">
          <div class="col-1">
            <label>Correo Electrónico</label>
            <input type="email" id="correo" />
          </div>
        </div>

        <div class="row">
          <div class="col-1">
            <label class="required">Dirección</label>
            <input type="text" id="direccion" />
          </div>
        </div>

        <div class="row">
          <div class="col-1">
            <label>Residencia</label>
            <div style="display:flex;gap:14px;flex-wrap:wrap" id="residenciaCheckboxes">
              <label><input type="checkbox" name="residencia" value="Propia"> Propia</label>
              <label><input type="checkbox" name="residencia" value="Alquilada"> Alquilada</label>
              <label><input type="checkbox" name="residencia" value="Financiada"> Financiada</label>
            </div>
          </div>
        </div>

        <div class="upload-section">
          <h3 class="required">Documento de Identidad</h3>
          <p style="font-size:12px; color:#64748b; margin-bottom:8px;">
            Suba copia legible de su documento (ambos lados).
          </p>

          <div class="row">
            <div class="col-2">
              <label class="required">Frente (Anverso)</label>
              <div class="upload-area" onclick="document.getElementById('cedulaFrente').click()">
                <div class="upload-icon"><i class="fas fa-id-card"></i></div>
                <p><small>Haga clic para subir</small></p>
                <input type="file" id="cedulaFrente" accept="image/*" style="display:none" onchange="previewFile(this, 'previewFrente')">
              </div>
              <div class="file-preview" id="previewFrente"></div>
            </div>

            <div class="col-2">
              <label class="required">Dorso (Reverso)</label>
              <div class="upload-area" onclick="document.getElementById('cedulaDorso').click()">
                <div class="upload-icon"><i class="fas fa-id-card"></i></div>
                <p><small>Haga clic para subir</small></p>
                <input type="file" id="cedulaDorso" accept="image/*" style="display:none" onchange="previewFile(this, 'previewDorso')">
              </div>
              <div class="file-preview" id="previewDorso"></div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- INFORMACIÓN LABORAL -->
    <div class="card">
      <div class="card-header">INFORMACIÓN LABORAL DEL SOLICITANTE</div>
      <div class="card-body">
        <div class="row">
          <div class="col-2">
            <label>Ocupación/Profesión</label>
            <input type="text" id="ocupacion" />
          </div>
          <div class="col-2">
            <label>Independiente/Empleado</label>
            <input type="text" id="tipoEmpleo" />
          </div>
        </div>
        <div class="row">
          <div class="col-1">
            <label>Lugar de Trabajo</label>
            <input type="text" id="lugarTrabajo" />
          </div>
        </div>
        <div class="row">
          <div class="col-1">
            <label>Dirección</label>
            <input type="text" id="direccionTrabajo" />
          </div>
        </div>
        <div class="row">
          <div class="col-2">
            <label>Sector Privado/Gobierno</label>
            <input type="text" id="sector" />
          </div>
          <div class="col-2">
            <label>Posición que Ocupa</label>
            <input type="text" id="posicion" />
          </div>
          <div class="col-2">
            <label>Fecha de Ingreso</label>
            <input type="date" id="fechaIngreso" />
          </div>
          <div class="col-2">
            <label>Sueldo</label>
            <input type="text" id="sueldo" inputmode="decimal" pattern="[0-9.,]*" />
          </div>
          <div class="col-2">
            <label>Tiempo de Servicio</label>
            <input type="text" id="tiempoServicio" inputmode="numeric" pattern="[0-9]*" />
          </div>
          <div class="col-2">
            <label>Jefe Inmediato</label>
            <input type="text" id="jefe" />
          </div>
        </div>
        <div class="row">
          <div class="col-1">
            <label>Otros Ingresos</label>
            <input type="text" id="otrosIngresos" inputmode="decimal" pattern="[0-9.,]*" />
          </div>
        </div>
        <div class="row">
          <div class="col-2">
            <label>Teléfono</label>
            <input type="tel" id="telTrabajo" inputmode="tel" maxlength="12" placeholder="000-000-0000" />
          </div>
          <div class="col-2">
            <label>Correo Electrónico</label>
            <input type="email" id="emailTrabajo" />
          </div>
        </div>
      </div>
    </div>

    <!-- REFERENCIAS PERSONALES -->
    <div class="card">
      <div class="card-header">REFERENCIAS PERSONALES</div>
      <div class="card-body">
        <div style="margin-bottom: 14px;">
          <strong>1</strong>
          <div class="row">
            <div class="col-3"><label>Nombre</label><input type="text" id="ref1Nombre" /></div>
            <div class="col-3"><label>Dirección</label><input type="text" id="ref1Direccion" /></div>
            <div class="col-3"><label>Teléfono Contacto</label><input type="tel" id="ref1Telefono" inputmode="tel" maxlength="12" placeholder="000-000-0000" /></div>
          </div>
        </div>
        <div>
          <strong>2</strong>
          <div class="row">
            <div class="col-3"><label>Nombre</label><input type="text" id="ref2Nombre" /></div>
            <div class="col-3"><label>Dirección</label><input type="text" id="ref2Direccion" /></div>
            <div class="col-3"><label>Teléfono Contacto</label><input type="tel" id="ref2Telefono" inputmode="tel" maxlength="12" placeholder="000-000-0000" /></div>
          </div>
        </div>
      </div>
    </div>

    <!-- DECLARACIÓN -->
    <div class="card" id="declaracionCard">
      <div class="card-header">DECLARACIÓN</div>
      <div class="card-body">
        <div id="declaracionTexto" style="font-size:12px; line-height:1.4; margin-bottom:12px;">
          El CLIENTE SOLICITANTE autoriza expresa y formalmente a TU PROGRESO RD a suministrar a centros de información patrimonial y extrapatrimonial necesaria a los fines de evaluación de crédito por parte de otras instituciones suscriptoras de dichos centros de información, reconociendo y garantizando que la revelación por dichas instituciones por parte de la institución y/o por los centros de información crediticia y/o por sus respectivos empleados, funcionarios y accionistas no conllevará violación de secreto profesional a los efectos del Artículo 377 del Código Penal ni generarán responsabilidades bajo los Artículos 1382 y siguientes del Código Civil, ni bajo ningún otro texto legal, al tiempo de renuncia expresa y formalmente al ejercicio de cualesquiera acciones o demandas a los fines de la reclamación de daños y perjuicios por dicha causa o motivo, o por el suministro de información inexacta y prometiendo la sumisión de sus representantes, accionistas y demás causahabientes a lo pactado en este Artículo en virtud de las disposiciones del Artículo 1120 del Código Civil.<br><br>
          Por este medio el CLIENTE SOLICITANTE autoriza a TU PROGRESO a consultar sobre sus datos en el Maestro de Cedulados que mantiene la Junta Central Electoral (JCE), conforme las disposiciones del Reglamento que establece el Procedimiento para Acceder al Maestro de Cedulados y Fija las Tasas por los Servicios de Acceso de fecha 23 de julio de 2013, descargando a TU PROGRESO RD de cualquier responsabilidad relativa a la consulta realizada en el referido Maestro, en el entendido de que dichos datos deberán ser manejados con la debida confidencialidad y no podrán ser divulgados sin consentimiento del CLIENTE SOLICITANTE.
        </div>

        <label class="required">Confirmo haber leído y acepto los términos anteriores</label>
        <div class="signature-check" id="signatureBox" onclick="toggleSignature()">
          <div class="check-box" id="checkMark"></div>
          <span>He leído y acepto la declaración. ✅</span>
        </div>
      </div>
    </div>

    <div class="btn-group">
      <button type="button" class="btn btn-outline" onclick="printCompact()"><i class="fas fa-print"></i> Imprimir</button>
    </div>
  </div>

  <script>
    document.getElementById('fecha').valueAsDate = new Date();

    function toggleSignature() {
      document.getElementById('checkMark').classList.toggle('checked');
    }

    let cedulaFrenteData = '';
    let cedulaDorsoData = '';

    function previewFile(input, targetId) {
      const target = document.getElementById(targetId);
      target.innerHTML = '';
      if (!input.files || !input.files[0]) {
        if (targetId === 'previewFrente') cedulaFrenteData = '';
        if (targetId === 'previewDorso') cedulaDorsoData = '';
        return;
      }

      const file = input.files[0];
      const reader = new FileReader();

      reader.onload = function(e) {
        if (file.type.startsWith('image/')) {
          const img = document.createElement('img');
          img.src = e.target.result;
          img.style.width = '100%';
          const div = document.createElement('div');
          div.className = 'preview-item';
          div.appendChild(img);
          target.appendChild(div);

          if (targetId === 'previewFrente') cedulaFrenteData = e.target.result;
          if (targetId === 'previewDorso') cedulaDorsoData = e.target.result;
        }
      };

      reader.readAsDataURL(file);
    }

    function formatNumber(value) {
      if (!value) return '';
      let clean = value.replace(/[^\d.]/g, '');
      let parts = clean.split('.');
      let integer = parts[0];
      let decimal = parts.length > 1 ? parts[1].substring(0, 2) : '00';
      integer = integer.replace(/\B(?=(\d{3})+(?!\d))/g, ',');
      return integer + '.' + (decimal || '00');
    }

    function unformatNumber(formatted) {
      if (!formatted) return '';
      return formatted.replace(/[^\d.]/g, '');
    }

    ['montoSolicitado', 'sueldo', 'otrosIngresos'].forEach(id => {
      const el = document.getElementById(id);
      el.addEventListener('blur', function() {
        const unformatted = unformatNumber(this.value);
        if (unformatted) {
          const num = parseFloat(unformatted);
          if (!isNaN(num)) {
            this.value = formatNumber(num.toFixed(2));
          }
        }
      });

      el.addEventListener('input', function() {
        this.value = this.value.replace(/[^\d.,]/g, '');
      });
    });

    function applyPhoneMask(input) {
      let value = input.value.replace(/\D/g, '');
      if (value.length > 6) {
        value = value.substring(0, 10);
        input.value = value.replace(/(\d{3})(\d{3})(\d{4})/, '$1-$2-$3');
      } else if (value.length > 3) {
        input.value = value.replace(/(\d{3})(\d{0,3})/, '$1-$2');
      } else {
        input.value = value;
      }
    }

    ['telefono', 'celular', 'ref1Telefono', 'ref2Telefono', 'telTrabajo'].forEach(id => {
      const el = document.getElementById(id);
      el.addEventListener('input', function() {
        applyPhoneMask(this);
      });
    });

    function validarCampos() {
      const requiredFields = [
        'fecha', 'deudor', 'montoSolicitado', 'plazoNumero', 'plazoFrecuencia', 'destino',
        'nombres', 'apellidos', 'fechaNac', 'cedula', 'direccion'
      ];
      let faltantes = [];

      requiredFields.forEach(id => {
        const el = document.getElementById(id);
        if (!el || !el.value.trim()) {
          const label = document.querySelector(`label[for="${id}"]`)?.textContent || 
                       document.querySelector(`#${id}`).previousElementSibling?.textContent || id;
          faltantes.push(label.replace(/\s*\*$/, ''));
        }
      });

      const firmado = document.getElementById('checkMark').classList.contains('checked');
      if (!firmado) faltantes.push('Aceptación de la declaración');

      const frente = document.getElementById('cedulaFrente').files.length;
      const dorso = document.getElementById('cedulaDorso').files.length;
      if (!frente) faltantes.push('Documento (frente)');
      if (!dorso) faltantes.push('Documento (dorso)');

      return faltantes;
    }

    function printCompact() {
      const faltantes = validarCampos();
      if (faltantes.length > 0) {
        alert('⚠️ No se puede imprimir. Complete los siguientes campos obligatorios:\n• ' + faltantes.join('\n• '));
        return;
      }

      const container = document.querySelector('.container').cloneNode(true);
      const nombreDeudor = document.getElementById('deudor').value.trim() || '_________________________';

      const inputs = container.querySelectorAll('input, select, textarea');
      inputs.forEach(el => {
        let text = '';
        if (el.type === 'checkbox') {
          text = el.checked ? '✅' : '';
        } else if (el.type === 'date') {
          if (el.value) {
            const d = new Date(el.value);
            text = d.toLocaleDateString('es-DO');
          }
        } else if (el.tagName === 'SELECT') {
          const selected = el.options[el.selectedIndex];
          text = selected ? selected.text : '';
        } else {
          text = el.value || '';
        }

        const span = document.createElement('span');
        span.textContent = text;
        el.replaceWith(span);
      });

      const residenciaDiv = container.querySelector('#residenciaCheckboxes');
      if (residenciaDiv) {
        const checks = residenciaDiv.querySelectorAll('input[type="checkbox"]');
        const selected = Array.from(checks).filter(c => c.checked).map(c => c.value);
        const span = document.createElement('span');
        span.textContent = selected.join(', ') || '—';
        residenciaDiv.replaceWith(span);
      }

      const declaracionDiv = container.querySelector('#declaracionTexto');
      if (declaracionDiv) {
        declaracionDiv.style.background = 'transparent';
        declaracionDiv.style.padding = '0';
        declaracionDiv.style.fontSize = '10pt';
        declaracionDiv.style.lineHeight = '1.3';
      }

      const firmaCheck = container.querySelector('.signature-check');
      if (firmaCheck) firmaCheck.remove();

      const declaracionCard = container.querySelector('#declaracionCard .card-body');
      if (declaracionCard) {
        const firmaDiv = document.createElement('div');
        firmaDiv.innerHTML = `
          <p style="margin-top:10px; font-size:10pt;">
            ${nombreDeudor}<br>
            Firmado en formato digital
          </p>
        `;
        declaracionCard.appendChild(firmaDiv);
      }

      const uploadSection = container.querySelector('.upload-section');
      if (uploadSection) {
        const imgContainer = document.createElement('div');
        imgContainer.style.display = 'flex';
        imgContainer.style.gap = '10px';
        imgContainer.style.marginTop = '8px';
        imgContainer.style.flexWrap = 'wrap';

        if (cedulaFrenteData) {
          const img1 = document.createElement('img');
          img1.src = cedulaFrenteData;
          img1.style.width = '100px';
          img1.style.border = '1px solid #000';
          imgContainer.appendChild(img1);
        }

        if (cedulaDorsoData) {
          const img2 = document.createElement('img');
          img2.src = cedulaDorsoData;
          img2.style.width = '100px';
          img2.style.border = '1px solid #000';
          imgContainer.appendChild(img2);
        }

        const uploadRow = uploadSection.querySelector('.row');
        if (uploadRow) {
          uploadRow.replaceWith(imgContainer);
        }
      }

      const btnGroup = container.querySelector('.btn-group');
      if (btnGroup) btnGroup.remove();

      const printWindow = window.open('', '_blank');
      if (!printWindow) {
        alert('Por favor, desactive el bloqueador de ventanas emergentes.');
        return;
      }

      printWindow.document.write(`
        <!DOCTYPE html>
        <html>
        <head>
          <meta charset="UTF-8">
          <meta name="viewport" content="width=device-width, initial-scale=1.0">
          <title>Imprimir Solicitud</title>
          <style>
            body {
              font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
              margin: 8px;
              line-height: 1.25;
              color: #000;
              font-size: 9.5pt;
            }
            .form-title {
              text-align: center;
              font-size: 14pt;
              font-weight: bold;
              color: #0d4a83;
              margin: 6px 0 10px;
            }
            .card {
              border: 1px solid #000;
              margin-bottom: 8px;
              page-break-inside: avoid;
            }
            .card-header {
              background: #0d4a83;
              color: white;
              padding: 4px 8px;
              font-weight: bold;
              font-size: 9.5pt;
            }
            .card-body {
              padding: 8px;
            }
            .row {
              display: flex;
              flex-wrap: wrap;
              gap: 6px;
              margin: 4px 0;
            }
            .col-1 { flex: 1 1 100%; }
            .col-2 { flex: 1 1 calc(50% - 6px); }
            .col-3 { flex: 1 1 calc(33.333% - 6px); }
            label {
              font-weight: bold;
              margin-bottom: 2px;
              display: block;
              font-size: 9pt;
            }
            span {
              font-size: 9pt;
            }
            img {
              max-width: 100%;
              height: auto;
              border: 1px solid #000;
            }
            @media print {
              body { margin: 0; }
            }
            @media (max-width: 600px) {
              .col-2, .col-3 { flex: 1 1 100%; }
            }
          </style>
        </head>
        <body>
          ${container.outerHTML}
          <script>
            window.onload = function() {
              setTimeout(() => window.print(), 500);
            };
          <\/script>
        </body>
        </html>
      `);
      printWindow.document.close();
    }
  </script>
</body>
</html>
